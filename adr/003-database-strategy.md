# ADR-003: Стратегия хранения данных
* Дата: 05.02.2026
* Статус: Принято
* Контекст:  
Платформа оперирует разнородными данными от жестко структурированных(инвентарь) до потоковой телеметрии и социальных графов. Использование только одной технологии(например RDBMS) приведет к узким местам в производительности и сложностям масштабирования.  
* ​Рассмотренные опции:  
- Единая реляционная БД (RDBMS)  
​Плюсы: ACID-транзакции, простота поддержки.  
​Минусы: SQL плохо масштабируется на запись огромных потоков телеметрии и медленно работает на глубоких графовых запросах («друзья друзей, которые бегают там же»).  
* Принятое решение и обоснование:  
Применить стратегию Polyglot Persistence, выбрав специализированные хранилища для каждого микросервиса  
- Social Graph Service: нужна графовая база данных (например, Neo4j) — для быстрого поиска групп и людей по интересам/локациям.  
Графовая БД необходима для выполнения требования о формировании социальных кругов  
- Activity Service(Сервис телеметрии)  
Ожидается большая нагрузка на запись, координаты GPS, пульс, темп, временные метки. Данные пишутся один раз и редко изменяются(Append only)  
Поэтому выбираем NoSQL Cassandra  
Обоснование:  
Cassandra оптимизирована для высокой скорости записи, что критично, когда миллионы одновременно бегут марафон.  
Поддерживает мультирегиональную репликацию. Если ДЦ в Европе упадёт, данные запишутся в США без потери функционала для пользователя.  
Линейное масштабирование добавлением нод  
- Inventory Service (Сервис инвентаря который интегрируется с уже готовым E-commerce)  
​Тип данных: Каталог товаров, характеристики (размер, цвет), статус износа пользовательского оборудования.  
​Выбранная технология: Реляционная БД DBMS (RDBMS).  
​Конкретное решение: PostgreSQL.  
​Обоснование:  
​ACID-транзакции  
​Связанность данных: Инвентарь связан с товаром, товар связан с брендом, категорией и историей покупок. Реляционная модель здесь идеальна.  
​JSONB: PostgreSQL позволяет хранить гибкие атрибуты товаров в JSON-формате внутри таблицы.  
- Competition & Training Service (Сервис соревнований и тренировок)  
​Тип данных:  
​Долгосрочные: Планы тренировок, история участий, расписание турниров.  
​Real-time: Лидерборды (рейтинговые таблицы), текущее место в забеге.  
​Выбранная технология: Гибридное решение (RDBMS + In-Memory).  
​Конкретное решение: PostgreSQL (для хранения планов) + Redis (для лидербордов).  
​Обоснование:  
​Redis (Sorted Sets): Идеален для реализации лидербордов ("Топ-10 бегунов прямо сейчас"). Операции изменения ранга происходят за O(log(N)), что обеспечивает мгновенное обновление позиций в реальном времени.  
​PostgreSQL: Надежное хранение планов тренировок и архива завершенных соревнований.  
- ​Identity Service (Сервис аутентификации и профилей)  
​Тип данных: Учетные записи, хеши паролей, роли, настройки приватности.  
​Выбранная технология: Relational DBMS (RDBMS).  
​Конкретное решение: PostgreSQL.  
​Обоснование:  
Преобладает нагрузка на чтение  
​Безопасность и целостность: Критически важно, чтобы данные пользователя были согласованы.  
​Стандарт индустрии: Большинство решений для Auth (например, Keycloak) нативно поддерживают RDBMS.  
- Analytics Service: Time-Series DB (например, ClickHouse) — для эффективного хранения и агрегации логов тренировок и биометрии.  
Позволит быстро строить отчеты за год/месяц, что невозможно сделать быстро на обычной SQL базе при миллионах записей  
- ​Notification & Promo Service: Документное хранилище (NoSQL, например MongoDB) — для гибкого хранения шаблонов промоакций и истории уведомлений.